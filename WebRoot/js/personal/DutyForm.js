var DutyForm=function(b){this.dutyId=b;var a=this.setup();var c=new Ext.Window({id:"DutyFormWin",title:"排班详细信息",iconCls:"menu-duty",width:550,height:260,maximizable:true,modal:true,layout:"fit",buttonAlign:"center",items:[this.setup()],keys:{key:Ext.EventObject.ENTER,fn:function(){DutyForm.save();},scope:this},buttons:[{text:"保存",iconCls:"btn-save",handler:function(){DutyForm.save();}},{text:"取消",iconCls:"btn-cancel",handler:function(){c.close();}}]});c.show();};DutyForm.save=function(){var a=Ext.getCmp("DutyForm");if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(b,d){Ext.ux.Toast.msg("操作信息","成功保存信息！");var c=d.result.exception;if(c!=undefined&&c!=""){Ext.ux.Toast.msg(" 操作信息",c);}Ext.getCmp("DutyGrid").getStore().reload();Ext.getCmp("DutyFormWin").close();},failure:function(b,c){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});Ext.getCmp("DutyFormWin").close();}});}};DutyForm.prototype.setup=function(){var b=(this.dutyId==null||this.dutyId==undefined)?"":this.dutyId;var a=new Ext.FormPanel({url:__ctxPath+"/personal/saveDuty.do",layout:"form",id:"DutyForm",border:false,bodyStyle:"padding:5px;",defaults:{anchor:"98%,98%"},formId:"DutyFormId",defaultType:"textfield",items:[{name:"duty.dutyId",id:"dutyId",xtype:"hidden",value:b},{id:"dutySystemId",name:"dutySystemId",xtype:"hidden"},{fieldLabel:"班制",name:"dutySysId",id:"dutySysId",xtype:"combo",allowBlank:false,editable:false,lazyInit:false,triggerAction:"all",listeners:{select:function(e,c,d){Ext.getCmp("dutySystemId").setValue(c.data.systemId);}},store:new Ext.data.SimpleStore({autoLoad:true,url:__ctxPath+"/personal/comboDutySystem.do",fields:["systemId","systemName"]}),displayField:"systemName",valueField:"systemId"},{fieldLabel:"开始时间",name:"duty.startTime",id:"startTime",format:"Y-m-d",allowBlank:false,xtype:"datefield"},{fieldLabel:"结束时间",name:"duty.endTime",format:"Y-m-d",id:"endTime",xtype:"datefield",allowBlank:false},{xtype:"container",layout:"column",fieldLabel:"员工",items:[{name:"duty.fullname",xtype:"textarea",id:"fullname",allowBlank:false,readOnly:true,columnWidth:0.999,height:45},{layout:"form",defaultType:"button",border:false,items:[{text:"选择",id:"userSelect",iconCls:"btn-user-sel",width:70,handler:function(){var c=false;if(b!=""){c=true;}UserSelector.getView(function(f,g){var d=Ext.getCmp("fullname");var e=Ext.getCmp("userId");d.setValue(g);e.setValue(f);},c).show();}},{width:70,text:"清空",iconCls:"reset",handler:function(){Ext.getCmp("fullname").setValue("");Ext.getCmp("userId").setValue("");}}]},{name:"duty.userId",id:"userId",xtype:"hidden"}]}]});if(this.dutyId!=null&&this.dutyId!="undefined"){a.getForm().load({deferredRender:false,url:__ctxPath+"/personal/getDuty.do?dutyId="+this.dutyId,waitMsg:"正在载入数据...",success:function(f,g){var c=g.result.data;var e=getDateFromFormat(c.startTime,"yyyy-MM-dd HH:mm:ss");var d=getDateFromFormat(c.endTime,"yyyy-MM-dd HH:mm:ss");Ext.getCmp("startTime").setValue(new Date(e));Ext.getCmp("endTime").setValue(new Date(d));Ext.getCmp("dutySystemId").setValue(c.dutySystem.systemId);Ext.getCmp("dutySysId").setValue(c.dutySystem.systemName);},failure:function(c,d){}});}return a;};