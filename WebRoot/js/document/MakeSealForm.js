MakeSealForm=Ext.extend(Ext.Window,{formPanel:null,toolbar:null,constructor:function(a){Ext.applyIf(this,a);this.initUI();MakeSealForm.superclass.constructor.call(this,{title:"在线制作电子印章",width:580,height:440,shim:false,modal:true,tbar:this.toolbar,iconCls:"menu-seal",layout:"fit",maximizable:true,buttonAlign:"center",buttons:this.buttons,items:[this.formPanel]});},initUI:function(){Ext.useShims=true;this.ekeyPanel=new NtkoSignPanel({height:200,border:true});this.formPanel=new Ext.FormPanel({layout:"form",defaults:{anchor:"98%,98%"},defaultType:"textfield",items:[this.ekeyPanel,{xtype:"hidden",name:"seal.sealId",value:this.sealId?this.sealId:""},{xtype:"hidden",name:"seal.fileId"},{xtype:"hidden",name:"seal.sealPath"},{fieldLabel:"印章名称",allowBlank:false,name:"seal.sealName"},{fieldLabel:"印章使用者",allowBlank:false,name:"seal.belongName"},{fieldLabel:"印章口令[6-32位]",inputType:"password",allowBlank:false,name:"sealPassword",minLength:6,maxLength:32},{fieldLabel:"印章序列号[只读]",allowBlank:false,name:"sealSN",readOnly:true}]});this.toolbar=new Ext.Toolbar({items:[{iconCls:"btn-add",text:"打开本地印章",scope:this,handler:this.openSign},{text:"新建",iconCls:"btn-add",scope:this,handler:this.newSign},{text:"保存",iconCls:"btn-save",scope:this,handler:this.saveSign}]});this.buttons=[{xtype:"button",text:"关闭",iconCls:"btn-cancel",scope:this,handler:function(){this.close();}}];if(this.sealId!=""&&this.sealId!=null&&this.sealId!=undefined){if(this.fileId!=""&&this.fileId!=null&&this.fileId!=undefined){var a=this.ekeyPanel.openFormURL(this.fileId,null);if(0!=a.StatusCode){this.formPanel.getCmpByName("seal.sealId").setValue("");this.fileId="";return;}this.setValue(a);}}},openSign:function(){var a=this.ekeyPanel.getEkeyObject();a.IsShowRect=false;a.OpenFromLocal("",true);if(0!=a.StatusCode){return;}this.formPanel.getCmpByName("seal.sealId").setValue("");this.fileId="";this.setValue(a);},newSign:function(){var a=this.ekeyPanel.getEkeyObject();a.IsShowRect=false;a.CreateNew();if(0!=a.StatusCode){return;}this.formPanel.getCmpByName("seal.sealId").setValue("");this.fileId="";this.setValue(a);},saveSign:function(){if(this.formPanel.getForm().isValid()){var a="";a=this.fileId?this.fileId:"";var e="";var f=this.formPanel.getCmpByName("seal.sealName").getValue();var c=this.formPanel.getCmpByName("seal.belongName").getValue();var b=this.formPanel.getCmpByName("sealPassword").getValue();var d=this.save(a,f,c,b);if(d&&d.success){a=d.fileId;e=d.filePath;this.formPanel.getCmpByName("seal.fileId").setValue(a);this.formPanel.getCmpByName("seal.sealPath").setValue(e);$postForm({formPanel:this.formPanel,scope:this,url:__ctxPath+"/document/saveSeal.do",callback:function(g,i){var h=Ext.getCmp("SealGrid");if(h!=null){h.getStore().reload();}this.close();}});}}},save:function(b,f,d,c){var a=this.ekeyPanel.save(b,f,d,c);var e=Ext.util.JSON.decode(a);if(e&&e.success){return e;}else{return{success:false};}},setValue:function(a){this.formPanel.getCmpByName("seal.sealName").setValue(a.SignName);this.formPanel.getCmpByName("seal.belongName").setValue(a.SignUser);this.formPanel.getCmpByName("sealPassword").setValue(a.Password);this.formPanel.getCmpByName("sealSN").setValue(a.SignSN);}});