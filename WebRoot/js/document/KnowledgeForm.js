KnowledgeForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(a){Ext.applyIf(this,a);this.initUI();KnowledgeForm.superclass.constructor.call(this,{id:"KnowledgeFormWin",title:"知识详细信息",iconCls:"menu-personal-doc",width:700,height:560,modal:true,maximizable:true,layout:"fit",items:this.formPanel,buttonAlign:"center",buttons:this.buttons});},initUI:function(){this.formPanel=new HT.FormPanel({url:__ctxPath+"/document/saveDocument.do",id:"KnowledgeForm",formId:"KnowledgeFormId",defaults:{anchor:"98%,98%",margins:{top:4,right:4,bottom:4,left:4}},items:[{name:"folderId",xtype:"hidden",value:this.folderId},{name:"document.docId",xtype:"hidden",value:this.docId==null?"":this.docId},{xtype:"textfield",fieldLabel:"文档名称",name:"document.docName",anchor:"98%",allowBlank:false},{xtype:"container",layout:"column",height:32,items:[{text:"选择目录:",xtype:"label",width:104},{name:"docFolderName",xtype:"textfield",width:200,readOnly:true,allowBlank:false,value:this.folderName},{xtype:"button",text:"请选择目录",scope:this,iconCls:"menu-mail_folder",handler:function(){DocFolderSelector.getView(function(f,c){var b=Ext.getCmp("KnowledgeForm");var e=b.getCmpByName("docFolderName");var d=b.getCmpByName("folderId");e.setValue(c);d.setValue(f);}).show();}},{xtype:"button",text:"清除目录",iconCls:"reset",scope:this,handler:function(){var b=Ext.getCmp("KnowledgeForm");var d=b.getCmpByName("docFolderName");var c=b.getCmpByName("folderId");d.setValue("");c.setValue("");}}]},{xtype:"textfield",fieldLabel:"作者",name:"document.author",anchor:"98%"},{xtype:"textfield",fieldLabel:"关键字",name:"document.keywords",anchor:"98%"},{height:280,anchor:"96%",xtype:"fckeditor",fieldLabel:"内容",name:"document.content",allowBlank:false},{xtype:"hidden",name:"document.docType",value:"文档"},{xtype:"container",layout:"column",border:false,defaults:{border:false},items:[{columnWidth:0.7,layout:"form",border:false,items:[{fieldLabel:"附件",xtype:"panel",id:"personFilePanel",frame:false,border:true,bodyStyle:"padding:4px 4px 4px 4px",height:80,autoScroll:true,html:""}]},{columnWidth:0.3,items:[{border:false,xtype:"button",text:"添加附件",iconCls:"menu-attachment",handler:function(){var b=App.createUploadDialog({file_cat:"document/knowledgeManage",callback:function(f){var c=Ext.getCmp("KnowledgeFormFileIds");var e=Ext.getCmp("personFilePanel");for(var d=0;d<f.length;d++){if(c.getValue()!=""){c.setValue(c.getValue()+",");}c.setValue(c.getValue()+f[d].fileId);Ext.DomHelper.append(e.body,'<span><a href="#" onclick="FileAttachDetail.show('+f[d].fileId+')">'+f[d].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+f[d].fileId+')"/>&nbsp;|&nbsp;</span>');}}});b.show(this);}},{xtype:"button",text:"清除附件",iconCls:"reset",handler:function(){var c=Ext.getCmp("KnowledgeFormFileIds");var b=Ext.getCmp("personFilePanel");b.body.update("");c.setValue("");}},{xtype:"hidden",name:"fileIds",id:"KnowledgeFormFileIds"}]}]}]});if(this.docId!=null&&this.docId!="undefined"){var a=this.formPanel;this.formPanel.loadData({url:__ctxPath+"/document/getDocument.do?docId="+this.docId,waitMsg:"正在载入数据...",preName:"document",root:"data",success:function(d,k){var g=Ext.util.JSON.decode(d.responseText).data;var b=g.docFolder.folderId;var c=g.docFolder.folderName;a.getCmpByName("folderId").setValue(b);a.getCmpByName("docFolderName").setValue(c);var h=g.attachFiles;var f=Ext.getCmp("personFilePanel");var j=Ext.getCmp("KnowledgeFormFileIds");for(var e=0;e<h.length;e++){if(j.getValue()!=""){j.setValue(j.getValue()+",");}j.setValue(j.getValue()+h[e].fileId);Ext.DomHelper.append(f.body,'<span><a href="#" onclick="FileAttachDetail.show('+h[e].fileId+')">'+h[e].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+h[e].fileId+')"/>&nbsp;|&nbsp;</span>');}},failure:function(b,c){Ext.MessageBox.show({title:"操作信息",msg:"载入信息失败，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}this.buttons=[{xtype:"button",text:"保存",iconCls:"btn-save",handler:this.saveRecord,scope:this},{xtype:"button",text:"关闭",iconCls:"btn-cancel",scope:this,handler:function(){this.close();}}];},saveRecord:function(){var a=this.formPanel;var b=this;if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(c,e){Ext.ux.Toast.msg("操作信息","成功信息保存！");var d=Ext.getCmp("KnowledgeGrid");if(d!=null&&d!=undefined){d.getStore().reload();}b.close();},failure:function(c,d){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});b.close();}});}}});function removeFile(e,a){var b=Ext.getCmp("KnowledgeFormFileIds");var d=b.getValue();if(d.indexOf(",")<0){b.setValue("");}else{d=d.replace(","+a,"").replace(a+",","");b.setValue(d);}var c=Ext.get(e.parentNode);c.remove();}