OnlineDocumentForm=Ext.extend(Ext.Window,{formPanel:null,fileId:null,constructor:function(a){Ext.applyIf(this,a);this.initUI();OnlineDocumentForm.superclass.constructor.call(this,{width:700,title:"在线文档",width:700,height:640,shim:false,modal:true,layout:"fit",iconCls:"menu-onlinedoc",maximizable:true,buttonAlign:"center",buttons:this.buttons,items:[this.formPanel]});},initUI:function(){Ext.useShims=true;this.docPanel=new NtkOfficePanel({showToolbar:true,height:500,doctype:this.docType,unshowMenuBar:false});this.formPanel=new HT.FormPanel({url:__ctxPath+"/document/saveOnlineDocument.do",defaults:{anchor:"98%,98%"},items:[{xtype:"hidden",name:"document.docId"},{name:"folderId",xtype:"hidden",value:this.folderId},{xtype:"container",layout:"column",height:32,items:[{text:"选择目录:",xtype:"label",width:104},{name:"OnlineDocFolderName",xtype:"textfield",width:370,readOnly:true,allowBlank:false,value:this.folderName},{xtype:"button",text:"请选择目录",scope:this,iconCls:"menu-mail_folder",handler:function(){var c=this.formPanel;DocFolderSelector.getView(function(g,d){var f=c.getCmpByName("OnlineDocFolderName");var e=c.getCmpByName("folderId");f.setValue(d);e.setValue(g);},true).show();}},{xtype:"button",text:"清除目录",iconCls:"reset",scope:this,handler:function(){var c=this.formPanel;var e=c.getCmpByName("OnlineDocFolderName");var d=c.getCmpByName("folderId");e.setValue("");d.setValue("");}}]},{fieldLabel:"文档名称",xtype:"textfield",allowBlank:false,name:"document.docName"},this.docPanel.panel,{xtype:"hidden",name:"documentFileId"},{xtype:"hidden",name:"document.docType",value:this.docType}]});var b=this.docPanel;var a=this.formPanel;if(this.docId!=null&&this.docId!="undefined"){this.formPanel.loadData({url:__ctxPath+"/document/getDocument.do?docId="+this.docId,waitMsg:"正在载入数据...",preName:"document",root:"data",success:function(e,g){var i=Ext.util.JSON.decode(e.responseText).data;var f=i.attachFiles;var d=i.docFolder.folderId;var j=i.docFolder.folderName;a.getCmpByName("folderId").setValue(d);a.getCmpByName("OnlineDocFolderName").setValue(j);if(f!=null){var c=f[0].fileId;a.getCmpByName("documentFileId").setValue(c);var h=f[0].filePath;b.openDoc(c);}},failure:function(c,d){Ext.MessageBox.show({title:"操作信息",msg:"载入信息失败，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}this.buttons=[{xtype:"button",text:"保存",iconCls:"btn-save",handler:this.saveRecord,scope:this},{xtype:"button",text:"关闭",iconCls:"btn-cancel",scope:this,handler:function(){this.docPanel.closeDoc();this.close();}}];},saveRecord:function(){var f=this;var b=this.formPanel;var e=b.getCmpByName("document.docName").getValue();var c=b.getCmpByName("documentFileId");var a="";a=c.getValue();var d=null;var g=this.docPanel;if(a!=""&&a!=undefined){d=g.saveDoc({docName:e,fileId:a,doctype:this.docType});}else{d=g.saveDoc({docName:e,doctype:this.docType});}if(d&&d.success){var a=d.fileId;c.setValue(a);if(b.getForm().isValid()){b.getForm().submit({method:"post",success:function(h,j){Ext.ux.Toast.msg("操作信息","成功信息保存！");var i=Ext.getCmp("OnlineDocumentGrid");if(i!=null&&i!=undefined){i.getStore().reload();}g.closeDoc();f.close();},failure:function(h,i){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});g.closeDoc();f.close();}});}}else{Ext.MessageBox.show({title:"操作信息",msg:"保存信息失败，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}}});