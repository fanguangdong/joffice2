NoticeView=Ext.extend(Ext.Panel,{constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();NoticeView.superclass.constructor.call(this,{id:"NoticeView",title:"公告管理",region:"center",iconCls:"menu-notice",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new HT.SearchPanel({layout:"form",region:"north",colNums:3,items:[{fieldLabel:"所属栏目",name:"Q_section.sectionName_S_LK",flex:1,xtype:"textfield"},{fieldLabel:"公告标题",name:"Q_subject_S_EQ",flex:1,xtype:"textfield"},{fieldLabel:"作者",name:"Q_author_S_EQ",flex:1,xtype:"textfield"},{fieldLabel:"创建时间",name:"Q_createtime_D_EQ",flex:1,xtype:"datefield",format:"Y-m-d"},{fieldLabel:"失效时间",name:"Q_expTime_D_EQ",flex:1,xtype:"datefield",format:"Y-m-d"},{fieldLabel:"发布人",name:"Q_issuer_S_EQ",flex:1,xtype:"textfield"},{fieldLabel:"状态",name:"Q_status_SN_EQ",flex:1,xtype:"numberfield"},{fieldLabel:"是否为桌面公告",name:"Q_isDeskImage_SN_EQ",flex:1,xtype:"numberfield"}],buttons:[{text:"查询",scope:this,iconCls:"btn-search",handler:this.search},{text:"重置",scope:this,iconCls:"btn-reset",handler:this.reset}]});this.topbar=new Ext.Toolbar({items:[{iconCls:"btn-add",text:"添加公告",xtype:"button",scope:this,handler:this.createRs},{iconCls:"btn-del",text:"删除公告",xtype:"button",scope:this,handler:this.removeSelRs}]});this.gridPanel=new HT.GridPanel({region:"center",tbar:this.topbar,rowActions:true,id:"NewsGrid",baseParams:{"Q_isNotice_SN_EQ":1},url:__ctxPath+"/info/listNews.do",fields:[{name:"newsId",type:"int"},"sectionId","subjectIcon","subject","author","createtime","expTime","replyCounts","viewCounts","issuer","content","updateTime","status","isDeskImage","isNotice","sn","section"],columns:[{header:"newsId",dataIndex:"newsId",hidden:true},{header:"所在栏目",dataIndex:"section",renderer:function(a){return a.sectionName;}},{header:"公告标题",dataIndex:"subject"},{header:"作者",dataIndex:"author"},{header:"创建时间",dataIndex:"createtime",renderer:function(a){if(a!=null){return a.substring(0,10);}}},{header:"失效时间",dataIndex:"expTime",renderer:function(a){if(a!=null){return a.substring(0,10);}}},{header:"发布人",dataIndex:"issuer"},{header:"公告状态",dataIndex:"status",renderer:function(a){if(a!=null&&a==0){return'<font color="red">禁用</font>';}else{if(a==1){return'<font color="green">激活</font>';}}}},new Ext.ux.grid.RowActions({header:"管理",width:100,actions:[{iconCls:"btn-del",qtip:"删除",style:"margin:0 3px 0 3px"},{iconCls:"btn-edit",qtip:"编辑",style:"margin:0 3px 0 3px"}],listeners:{scope:this,"action":this.onRowAction}})]});this.gridPanel.addListener("rowdblclick",this.rowClick);},reset:function(){this.searchPanel.getForm().reset();},search:function(){$search({searchPanel:this.searchPanel,gridPanel:this.gridPanel});},rowClick:function(b,a,c){b.getSelectionModel().each(function(d){new NoticeForm({newsId:d.data.newsId}).show();});},createRs:function(){new NoticeForm().show();},removeRs:function(a){$postDel({url:__ctxPath+"/info/multiDelNews.do",ids:a,grid:this.gridPanel});},removeSelRs:function(){$delGridRs({url:__ctxPath+"/info/multiDelNews.do",grid:this.gridPanel,idName:"newsId"});},editRs:function(a){new NoticeForm({newsId:a.data.newsId}).show();},onRowAction:function(c,a,d,e,b){switch(d){case"btn-del":this.removeRs.call(this,a.data.newsId);break;case"btn-edit":this.editRs.call(this,a);break;default:break;}}});