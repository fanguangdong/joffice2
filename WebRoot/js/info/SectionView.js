Portlet=Ext.extend(Ext.ux.Portlet,{tools:null,url:null,constructor:function(a){Ext.applyIf(this,a);this.initTool(a);if(a.sectionType==2){this.url=__ctxPath+"/pages/indexpages/deskNewsListPage.jsp?sectionId="+a.sectionId;}else{if(a.sectionType==3){this.url=__ctxPath+"/pages/indexpages/noticeScrollPage.jsp?sectionId="+a.sectionId;}else{this.url=__ctxPath+"/pages/indexpages/newsListPage.jsp?sectionId="+a.sectionId;}}Portlet.superclass.constructor.call(this,{title:a.title,iconCls:a.iconCls,tools:this.tools,autoLoad:{url:this.url,scripts:true}});},initTool:function(a){this.tools=[{id:"refresh",scope:this,handler:function(){this.getUpdater().update(this.url);}},{id:"close",scope:this,handler:function(d,c,b){Ext.Msg.confirm("提示信息","确认删除此模块吧？",function(e){if(e=="yes"){b.ownerCt.remove(b,true);Ext.Ajax.request({url:__ctxPath+"/info/disableSection.do",method:"POST",params:{sectionId:a.sectionId},success:function(){},failure:function(){}});}});}}];}});SectionView=Ext.extend(Ext.Panel,{toolbar:null,constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();SectionView.superclass.constructor.call(this,{title:"栏目管理",closable:false,id:"SectionView",iconCls:"menu-section-view",layout:"fit",defaults:{padding:"0 5 0 0"},tbar:this.toolbar,items:[]});},initUIComponents:function(){this.toolbar=new Ext.Toolbar({height:30,items:[{iconCls:"btn-add",text:"添加栏目",xtype:"button",scope:this,handler:this.createRs},"-",{iconCls:"btn-refresh",text:"刷新视图",xtype:"button",scope:this,handler:this.refreshRs.createCallback(this)},"-",{xtype:"button",text:"保存视图",scope:this,iconCls:"btn-save",handler:this.positionRs.createCallback(this)},"-",{xtype:"button",text:"添加模块",scope:this,iconCls:"btn-add",handler:function(){var b=this.getCmpByName("FirstColumn");new SectionSelector({isSingle:false,status:0,callback:function(h,d,g){this.close();var j=h.split(",");var f=d.split(",");var c=g.split(",");for(var e=0;e<j.length;e++){if(j[e]!=null&&j[e]!=""&&j[e]!="undefined"){b.add(new Portlet({title:f[e],sectionId:j[e],sectionType:c[e]}));}}b.ownerCt.doLayout();Ext.Ajax.request({url:__ctxPath+"/info/enableSection.do",method:"POST",params:{secIds:h},success:function(){},failure:function(){}});}}).show();}},"-",{xtype:"button",text:"视图设置",iconCls:"btn-system-setting",scope:this,handler:this.viewSettingRs.createCallback(this)}]});var a=[{id:"gear",handler:function(){Ext.Msg.alert("Message","The Settings tool was clicked.");}},{id:"close",handler:function(d,c,b){b.ownerCt.remove(b,true);}}];this.refreshRs(this);},createRs:function(){new SectionForm().show();},refreshRs:function(a,d){a.removeAll(true);a.doLayout();var e=[];var c=[];var b=[];Ext.Ajax.request({url:__ctxPath+"/info/listSection.do",method:"POST",params:{"Q_status_SN_EQ":1},success:function(f){var h=Ext.util.JSON.decode(f.responseText);var j=h.result;if(d==null||d==undefined||d==""){d=h.columnType;}for(var g=0;g<h.totalCounts;g++){var l=j[g];if(d==1){e.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}else{if(d==2){if(l.colNumber==1){e.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}else{c.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}}else{if(l.colNumber==1){e.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}else{if(l.colNumber==2){c.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}else{b.push(new Portlet({title:l.sectionName,sectionId:l.sectionId,sectionType:l.sectionType}));}}}}}var k=null;if(d==1){k=[{columnWidth:0.98,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:e}];}else{if(d==2){k=[{columnWidth:0.64,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:e},{columnWidth:0.35,style:"padding:10px 10px 10px 10px",items:c}];}else{k=[{columnWidth:0.33,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:e},{columnWidth:0.33,style:"padding:10px 10px 10px 10px",items:c},{columnWidth:0.33,style:"padding:10px 0px 10px 0px",items:b}];}}a.add({xtype:"portal",region:"center",border:false,id:"SectionPortal",margins:"35 5 5 0",items:k});a.doLayout();},failure:function(){}});},positionRs:function(){var h=Ext.getCmp("SectionPortal");var c=h.items;var g=new Array();for(var e=0;e<c.length;e++){var b=c.itemAt(e);for(var d=0;d<b.items.getCount();d++){var a=b.items.itemAt(d);var f=new SectionItem(a.sectionId,e+1,d+1);g.push(f);}}Ext.Ajax.request({method:"post",url:__ctxPath+"/info/positionSection.do",params:{sections:Ext.encode(g)},success:function(i){Ext.ux.Toast.msg("操作信息","保存成功");},failure:function(i){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});},viewSettingRs:function(a){var b=new Ext.FormPanel({layout:"form",bodyStyle:"padding:10px",border:false,defaults:{anchor:"98%,98%"},items:[{xtype:"radiogroup",id:"columnLayout",autoHeight:true,columns:1,items:[{boxLabel:"一列布局",name:"columnType",inputValue:"1"},{boxLabel:"两列布局",name:"columnType",inputValue:"2",checked:true},{boxLabel:"三列布局",name:"columnType",inputValue:"3"}]}]});var c=new Ext.Window({layout:"fit",iconCls:"btn-system-setting",items:b,modal:true,minHeight:149,minWidth:499,height:150,width:500,maximizable:true,title:"视图设置",buttonAlign:"center",buttons:[{text:"确定",iconCls:"btn-save",handler:function(){var f="";var d=Ext.getCmp("columnLayout");var e=d.getValue().getGroupValue();Ext.Ajax.request({url:__ctxPath+"/info/columnSection.do",method:"POST",params:{columnType:e},success:function(){Ext.ux.Toast.msg("操作信息","视图设置成功.");},failure:function(){}});a.refreshRs(a,e);c.close();}},{text:"取消",iconCls:"btn-cancel",handler:function(){c.close();}}]});c.show();}});