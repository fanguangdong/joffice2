ArchivesMonitor=Ext.extend(Ext.Panel,{constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();ArchivesMonitor.superclass.constructor.call(this,{id:"ArchivesMonitor",iconCls:"menu-archive-monitor",title:"流程监控",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new Ext.FormPanel({height:35,region:"north",frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{style:"padding:0px 5px 0px 5px;",border:false,anchor:"98%,98%",labelWidth:75,xtype:"label"},items:[{text:"类型名称"},{name:"Q_typeName_S_LK",width:100,xtype:"textfield"},{text:"发文字号"},{width:100,name:"Q_archivesNo_S_LK",xtype:"textfield"},{text:"文件标题"},{width:100,name:"Q_subject_S_LK",xtype:"textfield"},{text:"公文状态"},{width:100,name:"Q_status_S_LK",xtype:"textfield"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)}]});this.gridPanel=new HT.GridPanel({region:"center",rowActions:true,baseParams:{"sort":"createtime","dir":"desc"},url:__ctxPath+"/archive/listArchives.do",fields:[{name:"archivesId",type:"int"},"archivesType","archivesRecType","archivesNo","issueDep","depId","subject","issueDate","status","shortContent","fileCounts","privacyLevel","urgentLevel","issuer","issuerId","keywords","sources","archType","createtime","runId","tasks","archStatus"],columns:[{header:"archivesId",dataIndex:"archivesId",hidden:true},{header:"公文类型名称",dataIndex:"archivesType",renderer:function(c,b,a){if(c){return c.typeName;}else{if(a.data.archivesRecType){return a.data.archivesRecType.typeName;}}}},{header:"发文字号",dataIndex:"archivesNo"},{header:"发文机关或部门",dataIndex:"issueDep"},{header:"文件标题",dataIndex:"subject"},{header:"公文状态",dataIndex:"status"},{header:"秘密等级",dataIndex:"privacyLevel"},{header:"紧急程度",dataIndex:"urgentLevel"},{header:"发文时间",dataIndex:"createtime",renderer:function(a){return a.substring(0,10);}},{header:"工作流",dataIndex:"tasks",renderer:function(c){var a="";if(c.length>0){for(var b=0;b<c.length;b++){a+=c[b].taskName;if(c[b].userId){a+="(";if(curUserInfo.userId==c[b].userId){a+='<a href="#" onclick="App.MyDesktopClickTopTab(\'ProcessNextForm\',{taskId:'+c[b].taskId+",activityName:'"+c[b].taskName+"'})\">";}a+=c[b].fullname;if(curUserInfo.userId==c[b].userId){a+="</a>";}a+=")&nbsp;&nbsp;";}}}return a;}},new Ext.ux.grid.RowActions({header:"管理",width:100,actions:[{iconCls:"btn-archives-detail",qtip:"查阅详情",style:"margin:0 3px 0 3px"},{iconCls:"btn-archives-remind",qtip:"催办",style:"margin:0 3px 0 3px",fn:function(a){if(isGranted("_ArchivesIssueHasten")){return true;}return false;}}],listeners:{scope:this,"action":this.onRowAction}})]});this.gridPanel.addListener("rowdblclick",this.rowClick);},rowClick:function(b,a,c){b.getSelectionModel().each(function(d){new ArchivesDetailWin({archivesId:d.data.archivesId,runId:d.data.runId}).show();});},search:function(a){if(a.searchPanel.getForm().isValid()){$search({searchPanel:a.searchPanel,gridPanel:a.gridPanel});}},delRecords:function(){var c=this.gridPanel;var a=c.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var d=Array();for(var b=0;b<a.length;b++){d.push(a[b].data.archivesId);}this.delByIds(d);},detail:function(a){new ArchivesDetailWin({archivesId:a.data.archivesId,runId:a.data.runId}).show();},remind:function(b){var a=b.data.status;var c=b.data.archStatus;var d="";if(c=="1"){Ext.ux.Toast.msg("提示信息","公文已归档!");return;}else{new ArchHastenForm({archivesId:b.data.archivesId,archivesNo:b.data.archivesNo,activityName:a}).show();}},approvalTask:function(a){var d=App.getContentPanel();var b=a.data.runId;var c=d.getItem("ProcessRunDetail"+b);if(c==null){c=new ProcessRunDetail(b,null,null,a.data.subject);d.add(c);}d.activate(c);},onRowAction:function(c,a,d,e,b){switch(d){case"btn-archives-detail":this.detail(a);break;case"btn-archives-remind":this.remind(a);break;case"btn-approvalTask":this.approvalTask(a);break;default:break;}}});ArchivesMonitor.jumpFlowTask=function(b,a){App.MyDesktopClickTopTab("ProcessNextForm",{taskId:b,activityName:a});};