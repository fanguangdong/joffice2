OutMailSetView=Ext.extend(Ext.Panel,{constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();OutMailSetView.superclass.constructor.call(this,{id:"OutMailSetView",title:"外部邮箱配置",iconCls:"menu-mail_send",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new Ext.FormPanel({id:"OutMailSetSearchForm",region:"north",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},keys:{key:Ext.EventObject.ENTER,fn:this.search.createCallback(this),scope:this},items:[{text:"查询条件:"},{text:"用户名称"},{anchor:"40%",xtype:"textfield",name:"userName"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)},{xtype:"button",text:"清空",iconCls:"reset",handler:this.clear,scope:this}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/system/listOutMailSet.do",totalProperty:"totalCounts",root:"result",baseParams:{start:0,limit:25},remoteSort:true,fields:[{name:"id",type:"int"},{name:"reuserId",mapping:"userId",type:"int"},"userName","mailAddress","mailPass","smtpHost","smtpPort","popHost","popPort"]});this.store.setDefaultSort("id","desc");this.store.load({params:{start:0,limit:25}});var b=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel({columns:[b,new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"userId",dataIndex:"reuserId",hidden:true},{header:"用户名称",dataIndex:"userName"},{header:"外部邮件地址",dataIndex:"mailAddress",vtype:"email",editor:new Ext.form.TextField({allowBlank:false,vtype:"email"})},{header:"密码",dataIndex:"mailPass",renderer:function(e){var d=e.length;var f="";for(var c=0;c<d;c++){f+="*";}return f;},editor:new Ext.form.TextField({allowBlank:false,inputType:"password"})},{header:"smtp主机",dataIndex:"smtpHost",editor:new Ext.form.TextField({allowBlank:false})},{header:"smtp端口",dataIndex:"smtpPort",vtype:"alphanum",editor:new Ext.form.NumberField({allowBlank:false,vtype:"alphanum",blankText:"端口必须是填写数字"})},{header:"pop主机",dataIndex:"popHost",editor:new Ext.form.TextField({allowBlank:false})},{header:"pop端口",dataIndex:"popPort",vtype:"alphanum",blankText:"端口必须是填写数字",editor:new Ext.form.NumberField({allowBlank:false,vtype:"alphanum",blankText:"端口必须是填写数字"})}],defaults:{sortable:true,menuDisabled:true,width:100}});this.topbar=new Ext.Toolbar({height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_OutMailSetAdd")){this.topbar.add(new Ext.Button({text:"保存外部邮箱配置",iconCls:"btn-save",handler:this.saveRecord,scope:this}));}this.gridPanel=new Ext.grid.EditorGridPanel({id:"OutMailSetGrid",tbar:this.topbar,clicksToEdit:1,region:"center",stripeRows:true,prunemodifiedrecords:true,store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,cm:a,sm:b,viewConfig:{forceFit:true,autoFill:true,forceFit:true},bbar:new Ext.PagingToolbar({pageSize:25,store:this.store,displayInfo:true,displayMsg:"当前页记录索引{0}-{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});},search:function(c){var a=Ext.getCmp("OutMailSetSearchForm");if(a.getForm().isValid()){var e=Ext.getCmp("OutMailSetGrid");var b=e.getStore();var f=Ext.Ajax.serializeForm(a.getForm().getEl());var d=Ext.urlDecode(f);d.start=0;d.limit=b.baseParams.limit;b.baseParams=d;e.getBottomToolbar().moveFirst();}},clear:function(){Ext.getCmp("OutMailSetSearchForm").getForm().reset();},saveRecord:function(){var d=[];var c=Ext.getCmp("OutMailSetGrid");var b=c.getStore();for(i=0,cnt=b.getCount();i<cnt;i+=1){var a=b.getAt(i);if(a.data.id==""||a.data.id==null){a.set("id",-1);}if(a.dirty){d.push(a.data);}}if(d.length==0){Ext.ux.Toast.msg("信息","没有对数据进行任何更改");return;}Ext.Ajax.request({method:"post",url:__ctxPath+"/system/saveOutMailSet.do",success:function(e){Ext.ux.Toast.msg("操作信息","成功设置外部邮箱！");b.reload();c.getView().refresh();},failure:function(e){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});},params:{data:Ext.encode(d)}});}});