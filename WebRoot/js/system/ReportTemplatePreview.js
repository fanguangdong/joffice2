var ReportTemplatePreview=function(c,e){searchButton=new Ext.Button({text:"查询",iconCls:"search",width:20});xlsButton=new Ext.Button({text:"excel",iconCls:"btn-xls"});htmlButton=new Ext.Button({text:"html",iconCls:"btn-ie"});pdfButton=new Ext.Button({text:"pdf",iconCls:"btn-pdf"});formPanel=new Ext.FormPanel({defaults:{anchor:"10%,10%"},frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[],scope:this,listeners:{"afterrender":function(f){pdfButton.on("click",function(g){if(f.getForm().isValid()){f.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(i,j){var h=Ext.util.JSON.decode(j.response.responseText);document.location.href=__ctxPath+"/report/report.jsp?reportId="+c+encodeURI(encodeURI(h.data))+"&reportType=pdf";},failure:function(h,i){}});}},this);htmlButton.on("click",function(g){if(f.getForm().isValid()){f.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(i,j){var h=Ext.util.JSON.decode(j.response.responseText);window.open(__ctxPath+"/report/report.jsp?reportId="+c+encodeURI(encodeURI(h.data))+"&reportType=html","blank");},failure:function(h,i){}});}},this);xlsButton.on("click",function(g){if(f.getForm().isValid()){f.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(i,j){var h=Ext.util.JSON.decode(j.response.responseText);document.location.href=__ctxPath+"/report/report.jsp?reportId="+c+encodeURI(encodeURI(h.data))+"&reportType=xls";},failure:function(h,i){}});}},this);searchButton.on("click",function(g){if(f.getForm().isValid()){f.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(j,k){var i=Ext.util.JSON.decode(k.response.responseText);var h=Ext.getCmp("reportTemp"+c);h.body.update('<iframe src="'+__ctxPath+"/report/report.jsp?reportId="+c+encodeURI(encodeURI(i.data))+'" height="98%" width="98%" scrolling="auto"></iframe>');},failure:function(h,i){}});}},this);}}}).show();var b=new Ext.Container({layout:"table",layoutConfig:{columns:8},defaults:{bodyStyle:"padding:20px"}});Ext.Ajax.request({url:__ctxPath+"/system/loadReportTemplate.do?reportId="+c,method:"POST",async:false,success:function(f,h){var v=0;var q=new Date();var k=new Date(q.getFullYear(),q.getMonth(),1);var g=new Date(q.getFullYear(),(q.getMonth())+1,1);formPanel.removeAll(true);var x=Ext.util.JSON.decode(f.responseText);for(var u=0;u<x.data.length;u++){var o=x.data[u].paramName;var l=x.data[u].paramType;var y=x.data[u].paramKey;var r=x.data[u].defaultVal;var t=x.data[u].paramTypeStr;var m=Ext.decode(t);var n=new Ext.form.Label({text:o+": "});switch(l){case"combo":Ext.apply(m,{allowBlank:true,value:r,fieldLabel:"",hiddenName:y,id:y+new Date(),width:100});b.add(n);var w=new Ext.form.ComboBox(m);b.add(w);break;case"diccombo":Ext.apply(m,{allowBlank:true,value:r,fieldLabel:"",name:y,id:y+new Date(),width:100});b.add(n);var j=new DicCombo(m);b.add(j);break;case"datetimefield":var p=v%2;switch(p){case 0:Ext.apply(m,{allowBlank:false,value:k,format:"Y-m-d H:i:s",fieldLabel:"",name:y,id:y+new Date(),width:200});b.add(n);b.add(m);v++;break;case 1:Ext.apply(m,{allowBlank:false,value:g,format:"Y-m-d H:i:s",fieldLabel:"",name:y,id:y+new Date(),width:200});b.add(n);b.add(m);v++;break;}break;case"datefield":var p=v%2;switch(p){case 0:Ext.apply(m,{allowBlank:false,value:k,format:"Y-m-d",fieldLabel:"",name:y,id:y+new Date(),width:100});b.add(n);b.add(m);v++;break;case 1:Ext.apply(m,{allowBlank:false,value:g,format:"Y-m-d",fieldLabel:"",name:y,id:y+new Date(),width:100});b.add(n);b.add(m);v++;break;}break;default:Ext.apply(m,{allowBlank:true,value:r,fieldLabel:"",name:y,id:y+new Date(),width:100});b.add(n);b.add(m);}}b.add(searchButton);formPanel.add(b);b.doLayout(true);formPanel.doLayout(true);}});var d=new Ext.Toolbar({autoWidth:true,layout:"hbox",defaults:{anchor:"10%,10%"},items:[pdfButton,xlsButton,htmlButton]});var a=new Ext.Panel({id:"ReportPreview"+c,title:"查看-"+e,iconCls:"menu-report",autoScroll:false,autoHeight:true,border:false,frame:false,listeners:{"afterrender":function(f){var j=formPanel.getHeight();var i=d.getHeight();var h=Ext.getCmp("reportTemp"+c).getHeight();var g=Ext.getCmp("centerTabPanel").getInnerHeight();Ext.getCmp("reportTemp"+c).setHeight(g-(j+i));Ext.getCmp("reportTemp"+c).doLayout();searchButton.fireEvent("click");}},items:[formPanel,d,{id:"reportTemp"+c,autoHeight:false,autoWidth:false,autoScroll:false,border:false,xtype:"panel",height:415,autoLoad:false}]});return a;};