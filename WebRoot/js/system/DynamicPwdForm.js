DynamicPwdForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();DynamicPwdForm.superclass.constructor.call(this,{id:"DynamicPwdFormWin",layout:"fit",items:this.formPanel,modal:true,height:226,width:418,minHeight:225,minWidth:417,iconCls:"btn-dynamic-pwd",maximizable:true,title:"令牌设置",buttonAlign:"center",buttons:this.buttons});},initUIComponents:function(){this.formPanel=new Ext.FormPanel({layout:"form",bodyStyle:"padding:10px 10px 10px 10px",border:false,id:"DynamicPwdForm",defaults:{anchor:"98%,98%"},reader:new Ext.data.JsonReader({root:"data"},[{name:"appUser.dynamicPwd",mapping:"dynamicPwd"}]),defaultType:"textfield",items:[{name:"appUser.userId",id:"userId",xtype:"hidden",value:this.userId==null?"":this.userId},{fieldLabel:"序列号",name:"appUser.dynamicPwd",allowBlank:false,id:"dynamicPwd"},{fieldLabel:"动态密码",allowBlank:false,name:"curDynamicPwd",id:"curDynamicPwd"}]});if(this.userId!=null&&this.userId!="undefined"){this.formPanel.getForm().load({deferredRender:false,url:__ctxPath+"/system/getAppUser.do?userId="+this.userId,waitMsg:"正在载入数据...",success:function(b,c){var a=Ext.util.JSON.decode(c.response.responseText).data[0];if(a.dyPwdStatus==1){Ext.getCmp("dyPwdFormButtonUnbind").show();}else{Ext.getCmp("dyPwdFormButtonBind").show();}},failure:function(a,b){}});}this.buttons=[{text:"绑定",id:"dyPwdFormButtonBind",hidden:true,iconCls:"btn-dynamic-bind",handler:this.bind.createCallback(this.formPanel,this)},{text:"解绑",id:"dyPwdFormButtonUnbind",hidden:true,iconCls:"btn-dynamic-unbind",handler:this.unbind.createCallback(this.formPanel,this)},{text:"取消",iconCls:"btn-cancel",handler:this.cancel.createCallback(this)}];},unbind:function(a,b){if(a.getForm().isValid()){a.getForm().submit({url:__ctxPath+"/system/unbindDyPwdAppUser.do",method:"POST",waitMsg:"正在提交数据...",success:function(c,d){var e=d.result.msg;Ext.ux.Toast.msg("操作信息",e);b.close();},failure:function(c,d){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});b.close();}});}},cancel:function(a){a.close();},bind:function(a,b){if(a.getForm().isValid()){a.getForm().submit({url:__ctxPath+"/system/bindDyPwdAppUser.do",method:"POST",waitMsg:"正在提交数据...",success:function(c,d){var e=d.result.msg;Ext.ux.Toast.msg("操作信息",e);b.close();},failure:function(c,d){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});b.close();}});}}});