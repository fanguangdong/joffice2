DicManager=Ext.extend(Ext.Panel,{constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();DicManager.superclass.constructor.call(this,{id:"DicManager",height:450,autoScroll:true,layout:"border",title:"数据字典分类管理",iconCls:"menu-dictionary",items:[this.leftPanel,this.centerPanel]});},initUIComponents:function(){this.leftPanel=new htsoft.ux.TreePanelEditor({region:"west",id:"dicType",title:"数据字典分类",collapsible:true,split:true,height:450,width:160,autoScroll:true,url:__ctxPath+"/system/treeGlobalType.do?catKey=DIC",onclick:function(f){this.selectedNode=f;var g=f.id;var e=Ext.getCmp("dicGrid");if(e!=null){if(g==0){e.setTitle("所有数据字典");}else{e.setTitle(f.text+"-数据字典");}var d=e.getStore();d.url=__ctxPath+"/system/listDictionary.do";d.baseParams={parentId:g};d.reload();}},contextMenuItems:[{text:"新建分类",scope:this,iconCls:"btn-add",handler:function(){var d=Ext.getCmp("dicType");var f=d.selectedNode.id;var e=new GlobalTypeForm({parentId:f,catKey:"DIC",callback:function(){d.root.reload();}});e.show();}},{text:"修改分类",scope:this,iconCls:"btn-edit",handler:function(){var e=Ext.getCmp("dicType");var d=e.selectedNode.id;var f=new GlobalTypeForm({proTypeId:d,callback:function(){Ext.getCmp("dicType").root.reload();}});f.show();}},{text:"添加字典项",scope:this,iconCls:"btn-add",handler:function(){var e=this.centerPanel;var f=Ext.getCmp("dicType");var g=f.selectedNode;var d=f.selectedNode.text;var h=0;if(g!=null){h=g.id;}if(h==0){Ext.ux.Toast.msg("操作信息","请从左选择字典分类");return;}new DictionaryForm({parentId:h,typeName:d,callback:function(){e.getStore().reload();}}).show();}}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/system/listDictionary.do",root:"result",totalProperty:"totalCounts",remoteSort:true,fields:[{name:"dicId",type:"int"},"itemName","itemValue","descp","sn","globalType"]});this.store.setDefaultSort("dicId","desc");this.store.load({params:{start:0,limit:25}});var c=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel({columns:[c,new Ext.grid.RowNumberer(),{header:"ID",dataIndex:"dicId",hidden:true},{header:"parentId",dataIndex:"globalType",hidden:true,renderer:function(d){if(d){return d.parentId;}else{return 0;}}},{header:"proTypeId",dataIndex:"globalType",hidden:true,renderer:function(d){if(d){return d.proTypeId;}}},{header:"分类名称",dataIndex:"itemName"},{header:"值",dataIndex:"itemValue",editor:new Ext.form.TextField({allowBlank:false})},{header:"描述",dataIndex:"descp",editor:new Ext.form.TextField()},{header:"序号",dataIndex:"sn",editor:new Ext.form.TextField()}],defaults:{sortable:true,menuDisabled:false,width:100}});var b=new Ext.Toolbar({items:[{text:"添加数字字典",iconCls:"btn-add",scope:this,handler:function(){var e=this.centerPanel;var f=Ext.getCmp("dicType");var g=f.selectedNode;var d=f.selectedNode.text;var h=0;if(g!=null){h=g.id;}if(h==0){Ext.ux.Toast.msg("操作信息","请从左选择字典分类");return;}new DictionaryForm({parentId:h,typeName:d,callback:function(){e.getStore().reload();}}).show();}},"-",{xtype:"button",text:"保存",iconCls:"btn-save",scope:this,handler:function(){var h=[];var g=this.centerPanel;var e=g.getStore();for(var f=0;f<e.getCount();f+=1){var d=e.getAt(f);if(d.dirty){h.push(d.data);}}if(h.length==0){Ext.ux.Toast.msg("信息","没有对数据进行任何更改");return;}Ext.Ajax.request({method:"post",url:__ctxPath+"/system/mulSaveDictionary.do",params:{data:Ext.encode(h)},success:function(i){Ext.ux.Toast.msg("操作信息","成功设置");e.reload();g.getView().refresh();},failure:function(i){Ext.ux.Toast.msg("操作信息","设置出错，请联系管理员!");}});}},"-",{text:"删除",iconCls:"btn-del",scope:this,handler:function(){var f=this.centerPanel;var d=f.getSelectionModel().getSelections();if(d.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var g=Array();for(var e=0;e<d.length;e++){g.push(d[e].data.dicId);}Ext.Msg.confirm("信息确认","您确认要删除所选记录吗？",function(h){if(h=="yes"){Ext.Ajax.request({url:__ctxPath+"/system/multiDelDictionary.do",params:{ids:g},method:"POST",success:function(i,j){Ext.ux.Toast.msg("操作信息","成功删除该数字字典！");f.getStore().reload();},failure:function(i,j){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});}},"-",{text:"转移类型",iconCls:"",handler:function(){var e=Ext.getCmp("dicGrid");var g=e.getSelectionModel().getSelections();var f="";if(g.length==0){Ext.ux.Toast.msg("操作信息","请选择记录!");return;}for(var d=0;d<g.length;d++){if(d>0){f+=",";}f+=g[d].data.dicId;}new DicTypeChangeWin({dicIds:f,callbal:function(){e.getStore().reload();}}).show();}}]});this.centerPanel=new Ext.grid.EditorGridPanel({region:"center",title:"数字字典管理",tbar:b,clicksToEdit:1,id:"dicGrid",store:this.store,sm:c,cm:a,height:450,viewConfig:{forceFit:true,autoFill:true},bbar:new Ext.PagingToolbar({pageSize:25,store:this.store,displayInfo:true,displayMsg:"当前页记录索引{0}-{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});}});