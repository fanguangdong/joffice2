var ReportParamForm=function(b,a){this.paramId=a;this.reportId=b;var c=new Ext.Window({id:"ReportParamFormWin",title:name+"详细信息",width:500,height:250,modal:true,layout:"form",plain:true,bodyStyle:"padding:5px;",items:[this.MainForm()]});c.show();};ReportParamForm.prototype.MainForm=function(){var c={};var a=new Ext.FormPanel({url:__ctxPath+"/system/saveReportParam.do",layout:"form",id:"ReportParamForm",frame:true,defaults:{width:400,anchor:"98%,98%"},formId:"ReportParamFormId",defaultType:"textfield",buttonAlign:"center",items:[{name:"reportParam.paramId",id:"paramId",xtype:"hidden",value:this.paramId==null?"":this.paramId},{xtype:"hidden",name:"reportParam.reportId",value:this.reportId},{xtype:"hidden",name:"reportParam.paramTypeStr",id:"paramTypeStr"},{fieldLabel:"参数名称",name:"reportParam.paramName",id:"paramName",allowBlank:false},{fieldLabel:"参数Key",name:"reportParam.paramKey",id:"paramKey",allowBlank:false},{fieldLabel:"类型",hiddenName:"reportParam.paramType",id:"paramType",xtype:"combo",mode:"local",allowBlank:false,editable:false,triggerAction:"all",store:[["textfield","文件输入框(textfield)"],["datefield","日期输入框(datefield)"],["datetimefield","时间输入框(datetimefield)"],["numberfield","数字输入框(numberfield)"],["combo","下拉框(combo)"],["diccombo","数据字典(diccombo)"]],value:"textfield",listeners:{select:function(j,e,f){var k=j.value;var d=Ext.getCmp("ReportParamForm");d.remove("defaultVal");switch(k){case"datefield":c={};Ext.apply(c,{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",xtype:"datefield",format:"Y-m-d",allowBlank:true});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(c);break;case"datetimefield":c={};Ext.apply(c,{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",xtype:"datetimefield",format:"Y-m-d H:i:s",allowBlank:true});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(c);break;case"numberfield":c={};Ext.apply(c,{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",xtype:"numberfield",allowBlank:true});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(c);break;case"combo":var g=new Ext.Panel({id:"ReportParamForm.comboContainer",layout:"form",buttonAlign:"center",buttons:[{text:"确定",iconCls:"btn-save",handler:function(){var o=Ext.getCmp("ReportParamForm.comboContainer").findById("comboStore");if(!o){Ext.getCmp("ReportParamFormWin").remove("ReportParamForm.comboContainer");d.show();return;}var p=o.getXType();if(p=="editorgrid"){var m=[];var t=o.getStore();t.each(function(u){m.push([u.data["value"],u.data["text"]]);});c={};Ext.apply(c,{xtype:"combo",fieldLabel:"缺省值",store:{xtype:"arraystore",fields:["value","text"],data:m},valueField:"value",displayField:"text",typeAhead:true,mode:"local",triggerAction:"all",forceSelection:true,hiddenName:"reportParam.defaultVal",id:"defaultVal"});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(new Ext.form.ComboBox(c));}else{if(p=="form"){var l=o.findById("url").getValue();var q=o.findById("root").getValue();var r=o.findById("value").getValue();var s=o.findById("text").getValue();var n=[r,s];c={};Ext.apply(c,{xtype:"combo",fieldLabel:"缺省值",store:{xtype:"jsonstore",autoLoad:true,root:q,url:__ctxPath+l,fields:n},valueField:r,displayField:s,typeAhead:true,mode:"local",triggerAction:"all",forceSelection:true,hiddenName:"reportParam.defaultVal",id:"defaultVal"});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(new Ext.form.ComboBox(c));}}Ext.getCmp("ReportParamFormWin").remove("ReportParamForm.comboContainer");d.show();}},{text:"取消",iconCls:"btn-cancel",handler:function(){Ext.getCmp("ReportParamFormWin").remove("ReportParamForm.comboContainer");d.show();}}]});var h=new Ext.FormPanel({layout:"form",frame:true,defaults:{anchor:"98%,98%"},modal:true,defaultType:"textfield",items:[{fieldLabel:"数据来源",xtype:"combo",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["ArrayStore","静态数据(ArrayStore)"],["JsonStore","动态数据(JsonStore)"]]}),valueField:"value",displayField:"text",typeAhead:true,mode:"local",triggerAction:"all",forceSelection:true,emptyText:"--数据来源--",listeners:{select:function(m,p,q){Ext.getCmp("ReportParamForm.comboContainer").remove("comboStore");var s=m.value;if(s=="ArrayStore"){var o=[["",""],["",""]];var t=new Ext.data.ArrayStore({fields:[{name:"value"},{name:"text"}]});t.loadData(o);var n=new Ext.grid.CheckboxSelectionModel();var l=new Ext.grid.EditorGridPanel({id:"comboStore",autoScroll:true,stripeRows:true,height:120,tbar:new Ext.Toolbar({height:25,bodyStyle:"text-align:left",items:[{iconCls:"btn-add",text:"添加",handler:function(){var v=Ext.getCmp("comboStore");var z=v.getStore();var x=v.getColumnModel();var w=new z.recordType();w.data={};var y=z.fields.keys;for(var u=0;u<y.length;u++){w.data[y[u]]="";}w.markDirty();v.stopEditing();z.insert(0,w);}},{iconCls:"btn-del",text:"删除",handler:function(){var w=Ext.getCmp("comboStore");w.stopEditing();var u=w.getSelectionModel().getSelections();if(u.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}for(var v=0;v<u.length;v++){w.getStore().remove(u[v]);}}}]}),store:t,trackMouseOver:true,disableSelection:false,loadMask:true,clicksToEdit:1,cm:new Ext.grid.ColumnModel({columns:[n,{header:"值域",dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{header:"显示域",dataIndex:"text",editor:new Ext.form.TextField({allowBlank:false})}],defaults:{sortable:true,menuDisabled:false}}),sm:n,viewConfig:{forceFit:true,autoFill:true}}).show();g.add(l);g.doLayout();}else{if(s=="JsonStore"){var r=new Ext.FormPanel({id:"comboStore",layout:"form",frame:true,defaults:{anchor:"98%,98%"},modal:true,defaultType:"textfield",items:[{fieldLabel:"请求URL",id:"url",xtype:"textfield",allowBlank:false},{fieldLabel:"root",id:"root",xtype:"textfield",allowBlank:false},{fieldLabel:"值域字段",id:"value",xtype:"textfield",allowBlank:false},{fieldLabel:"显示域字段",id:"text",xtype:"textfield",allowBlank:false}]}).show();g.add(r);g.doLayout();}}}}}]});g.add(h);g.doLayout();Ext.getCmp("ReportParamFormWin").add(g);d.hide();Ext.getCmp("ReportParamFormWin").doLayout();break;case"diccombo":var i=new Ext.FormPanel({layout:"form",id:"ReportParamForm.prototype.diccomboForm",frame:true,defaults:{width:400,anchor:"98%,98%"},modal:true,defaultType:"textfield",buttonAlign:"center",items:[{fieldLabel:"数据字典名称(itemName)",id:"itemName",width:200,xtype:"textfield",allowBlank:false}],buttons:[{text:"确定",iconCls:"btn-save",handler:function(){var l=Ext.getCmp("itemName").getValue();c={};Ext.apply(c,{xtype:"diccombo",fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",mode:"local",itemName:l,displayField:"itemValue",valueField:"itemValue"});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(new DicCombo(c));Ext.getCmp("ReportParamFormWin").remove("ReportParamForm.prototype.diccomboForm");d.show();}},{text:"取消",iconCls:"btn-cancel",handler:function(){Ext.getCmp("ReportParamFormWin").remove("ReportParamForm.prototype.diccomboForm");d.show();}}]}).show();Ext.getCmp("ReportParamFormWin").add(i);d.hide();Ext.getCmp("ReportParamFormWin").doLayout();break;default:c={};Ext.apply(c,{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",xtype:"textfield",allowBlank:true});d.findById("paramTypeStr").setValue(Ext.encode(c));d.add(c);}d.doLayout(true);}}},{fieldLabel:"系列号",name:"reportParam.sn",id:"sn",xtype:"numberfield",allowBlank:false},{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",allowBlank:true}],buttons:[{text:"保存",iconCls:"btn-save",handler:function(){var d=Ext.getCmp("ReportParamForm");if(d.getForm().isValid()){var e=d.findById("paramTypeStr").getValue();if(e==""){e={};Ext.apply(e,{fieldLabel:"缺省值",name:"reportParam.defaultVal",id:"defaultVal",xtype:"textfield",allowBlank:true});d.findById("paramTypeStr").setValue(Ext.encode(e));}d.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(f,g){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ReportParamGrid").getStore().reload();Ext.getCmp("ReportParamFormWin").close();},failure:function(f,g){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});Ext.getCmp("ReportParamFormWin").close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){Ext.getCmp("ReportParamFormWin").close();}}]});if(this.paramId!=null&&this.paramId!="undefined"){var b=this.paramId;a.on("afterrender",function(d){d.getForm().load({deferredRender:false,url:__ctxPath+"/system/getReportParam.do?paramId="+b,waitMsg:"正在载入数据...",success:function(f,i){var h=i.result.data.paramType;var l=i.result.data.defaultVal;var j=i.result.data.paramTypeStr;var e=Ext.getCmp("ReportParamForm");if(j!==null&&j!=""&&j!=undefined){e.remove("defaultVal");switch(h){case"combo":var g=new Ext.form.ComboBox(Ext.decode(j));g.setValue(l);e.add(g);break;case"diccombo":var k=new DicCombo(Ext.decode(j));k.setValue(l);e.add(k);break;default:var m=Ext.decode(j);Ext.apply(m,{value:l});e.add(m);}e.doLayout(true);}},failure:function(e,f){}});});}return a;};