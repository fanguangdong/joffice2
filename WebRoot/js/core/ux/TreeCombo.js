var TreeCombo=Ext.extend(Ext.form.ComboBox,{constructor:function(b){var c={store:new Ext.data.SimpleStore({fields:[],data:[[]]}),editable:false,mode:"local",emptyText:"请选择",triggerAction:"all",maxHeight:200,tpl:"<tpl for='.'><div style='height:200px'><div id='"+b.id+"tree'></div></div></tpl>",onSelect:Ext.emptyFn}||b;Ext.apply(this,c);TreeCombo.superclass.constructor.call(this,c);var a=new Ext.tree.TreePanel({id:b.id+"Tree",height:200,autoScroll:true,split:true,loader:new Ext.tree.TreeLoader({url:b.url}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false});var d=this;d.on("collapse",function(f){var e=a.getSelectionModel().getSelectedNode();if(e==null){d.expand();return;}else{a.getSelectionModel().clearSelections();}},this);a.on("click",function(f){var e=Ext.getCmp(b.valId);if(f.id!=null&&f.id!=""){d.setValue(f.text);d.id=f.id;d.collapse();if(e!=null){e.setValue(f.id);}}});this.on("expand",function(){a.render(b.id+"tree");});}});Ext.reg("treecombo",TreeCombo);