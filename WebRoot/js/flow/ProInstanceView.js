ProInstanceView=Ext.extend(Ext.Panel,{searchPanel:null,gridPanel:null,constructor:function(a){Ext.applyIf(this,a);this.initUI();ProInstanceView.superclass.constructor.call(this,{layout:"border",iconCls:"menu-instance",title:this.flowName+"--实例管理",items:[this.searchPanel,this.gridPanel]});},initUI:function(){this.searchPanel=new HT.SearchPanel({layout:"form",region:"north",colNums:3,items:[{fieldLabel:"标题",name:"Q_subject_S_LK",flex:1,xtype:"textfield"},{xtype:"hidden",name:"Q_proDefinition.defId_L_EQ",value:this.defId},{xtype:"hidden",name:"Q_runStatus_SN_EQ",value:1}],buttons:[{text:"查询",scope:this,iconCls:"btn-search",handler:this.search},{text:"重置",scope:this,iconCls:"btn-reset",handler:this.reset}]});this.topbar=new Ext.Toolbar({items:[{iconCls:"btn-refresh",text:"刷新",xtype:"button",scope:this,handler:this.refreshRs},{iconCls:"btn-detail",text:"查看",xtype:"button",scope:this,handler:this.detailRsM},{iconCls:"btn-close",text:"结束实例",xtype:"button",scope:this,handler:this.closeIns}]});this.gridPanel=new HT.GridPanel({region:"center",tbar:this.topbar,rowActions:true,url:__ctxPath+"/flow/instanceProcessRun.do",baseParams:{"Q_proDefinition.defId_L_EQ":this.defId,"Q_runStatus_SN_EQ":1},fields:[{name:"runId",type:"int"},"subject","createtime","defId","piId","runStatus"],columns:[{header:"runId",dataIndex:"runId",hidden:true},{header:"标题",dataIndex:"subject"},{header:"创建时间",dataIndex:"createtime"},new Ext.ux.grid.RowActions({header:"管理",width:32,fixed:true,resizable:false,actions:[{iconCls:"btn-detail",qtip:"查看",style:"margin:0 3px 0 3px"}],listeners:{scope:this,"action":this.onRowAction}})]});},reset:function(){this.searchPanel.getForm().reset();},search:function(){$search({searchPanel:this.searchPanel,gridPanel:this.gridPanel});},refreshRs:function(){this.gridPanel.getStore().reload();},detailRsM:function(){var a=this.gridPanel.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("操作信息","请选择记录！");return;}if(a.length>1){Ext.ux.Toast.msg("操作信息","只能选择一条记录！");return;}this.detailRs(a[0]);},closeIns:function(){var c=this.gridPanel;var d=$getGdSelectedIds(c,"runId");if(d.length==0){Ext.ux.Toast.msg("操作信息","请选择记录！");return;}var a="";for(var b=0;b<d.length;b++){if(a!=""){a+=",";}a+=d[b];}Ext.Msg.confirm("信息确认","您确认要结束所选实例吗？",function(e){if(e=="yes"){Ext.Ajax.request({url:__ctxPath+"/flow/endProcessRun.do",params:{runIds:a},method:"post",success:function(g,h){var f=Ext.util.JSON.decode(g.responseText);if(f.success){Ext.ux.Toast.msg("信息提示","成功结束实例！");c.getStore().reload();}else{Ext.ux.Toast.msg("信息提示","出错，请联系管理员！");c.getStore().reload();}},failure:function(){Ext.ux.Toast.msg("信息提示","出错，请联系管理员！");c.getStore().reload();}});}});},detailRs:function(a){new ProInstanceDetail({runId:a.data.runId,subject:a.data.subject}).show();},onRowAction:function(c,a,d,e,b){switch(d){case"btn-detail":this.detailRs.call(this,a);break;default:break;}}});