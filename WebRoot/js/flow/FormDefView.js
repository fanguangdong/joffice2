FormDefView=Ext.extend(Ext.Panel,{constructor:function(a){Ext.applyIf(this,a);this.initUIComponents();FormDefView.superclass.constructor.call(this,{id:"FormDefView",title:"流程表单定义管理",region:"center",iconCls:"menu-form",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new HT.SearchPanel({layout:"form",region:"north",colNums:3,items:[{fieldLabel:"表单标题",name:"Q_formTitle_S_EQ",flex:1,xtype:"textfield"},{fieldLabel:"表单描述",name:"Q_formDesp_S_EQ",flex:1,xtype:"textfield"}],buttons:[{text:"查询",scope:this,iconCls:"btn-search",handler:this.search},{text:"重置",scope:this,iconCls:"btn-reset",handler:this.reset}]});this.topbar=new Ext.Toolbar({items:[{iconCls:"btn-add",text:"添加表单",xtype:"button",scope:this,handler:this.createRs},{iconCls:"btn-del",text:"删除表单",xtype:"button",scope:this,handler:this.removeSelRs},{iconCls:"btn-check",text:"创建全部实体",xtype:"button",scope:this,handler:this.genAllEnt}]});this.gridPanel=new HT.GridPanel({region:"center",tbar:this.topbar,rowActions:true,id:"FormDefGrid",url:__ctxPath+"/flow/listFormDef.do",fields:[{name:"formDefId",type:"int"},"formTitle","formDesp","defHtml","status","isGen","isDefault"],columns:[{header:"formDefId",dataIndex:"formDefId",hidden:true},{header:"表单名称",dataIndex:"formTitle"},{header:"表单描述",dataIndex:"formDesp"},{header:"状态",dataIndex:"status",renderer:function(a){if(a==1){return'<font color="green">正式发布</font>';}return'<font color="red">草稿</font>';}},{header:"是否已生成实体",dataIndex:"isGen",renderer:function(a){if(a==1){return'<font color="green">已生成</font>';}return'<font color="red">未生成</font>';}},new Ext.ux.grid.RowActions({header:"管理",width:100,actions:[{iconCls:"btn-del",qtip:"删除",style:"margin:0 3px 0 3px",fn:function(a){if(a.data.isDefault==1){return false;}return true;}},{iconCls:"btn-edit",qtip:"编辑",style:"margin:0 3px 0 3px"},{iconCls:"btn-check",qtip:"创建实体",style:"margin:0 3px 0 3px",fn:function(a){if(a.data.status==1){return true;}return false;}},{iconCls:"btn-detail",qtip:"查看",style:"margin: 0 3px 0 3px"}],listeners:{scope:this,"action":this.onRowAction}})]});},reset:function(){this.searchPanel.getForm().reset();},search:function(){$search({searchPanel:this.searchPanel,gridPanel:this.gridPanel});},rowClick:function(b,a,c){b.getSelectionModel().each(function(d){new FormDefForm({formDefId:d.data.formDefId}).show();});},createRs:function(){var a=this.gridPanel;new FormDesignPanelForm({callback:function(){a.getStore().reload();}}).show();},removeRs:function(a){$postDel({url:__ctxPath+"/flow/multiDelFormDef.do",ids:a,grid:this.gridPanel});},removeSelRs:function(){$delGridRs({url:__ctxPath+"/flow/multiDelFormDef.do",grid:this.gridPanel,idName:"formDefId"});},editRs:function(a){var b=this.gridPanel;new FormDesignPanelForm({formDefId:a.data.formDefId,callback:function(){b.getStore().reload();}}).show();},genAllEnt:function(){var a=this.gridPanel.getStore().getTotalCount();if(a==0){Ext.ux.Toast.msg("操作信息","没有要生成的实体！");return;}var b=this.gridPanel;Ext.Msg.confirm("信息确认","您确认要创建全部实体吗？",function(c){if(c=="yes"){Ext.MessageBox.show({msg:"实体创建中，请稍后...",width:300,wait:true,progress:true,closable:true,waitConfig:{interval:200},icon:Ext.Msg.INFO});Ext.Ajax.request({url:__ctxPath+"/flow/genAllFormDef.do",timeout:120000,method:"post",success:function(d,e){Ext.MessageBox.hide();var f=Ext.decode(d.responseText);if(f.success){Ext.ux.Toast.msg("操作信息","成功创建实体！");b.getStore().reload();}else{Ext.ux.Toast.msg("操作信息","创建实体出错，请联系管理员！");}},failure:function(){Ext.MessageBox.hide();Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});},genEnt:function(a){var b=this.gridPanel;Ext.Msg.confirm("信息确认","您确认要创建所选实体吗？",function(c){if(c=="yes"){Ext.MessageBox.show({msg:"实体创建中，请稍后...",width:300,wait:true,progress:true,closable:true,waitConfig:{interval:200},icon:Ext.Msg.INFO});Ext.Ajax.request({url:__ctxPath+"/flow/genFormDef.do",params:{formDefId:a.data.formDefId},method:"post",timeout:120000,success:function(d,e){Ext.MessageBox.hide();var f=Ext.decode(d.responseText);if(f.success){Ext.ux.Toast.msg("操作信息","成功创建实体！");b.getStore().reload();}else{Ext.ux.Toast.msg("操作信息","创建实体出错，请联系管理员！");}},failure:function(){Ext.MessageBox.hide();Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});},detailEnt:function(a){new FormDefDetailWin({formDefId:a.data.formDefId}).show();},onRowAction:function(c,a,d,e,b){switch(d){case"btn-del":this.removeRs.call(this,a.data.formDefId);break;case"btn-edit":this.editRs.call(this,a);break;case"btn-check":this.genEnt.call(this,a);break;case"btn-detail":this.detailEnt.call(this,a);break;default:break;}}});